# Generated by CMake Nix Generator
with import <nixpkgs> {};

let
  # Per-translation-unit derivations
  mylib_lib_c_o = stdenv.mkDerivation {
    name = "lib.o";
    src = ./.;
    buildInputs = [ gcc ];
    dontFixup = true;
    # Configuration: Release
    buildPhase = ''
      gcc -c -Dmylib_EXPORTS -fPIC "../lib.c" -o "$out"
    '';
    installPhase = "true"; # No install needed for objects
  };

  versioned_lib_versioned_c_o = stdenv.mkDerivation {
    name = "versioned.o";
    src = ./.;
    buildInputs = [ gcc ];
    dontFixup = true;
    # Configuration: Release
    buildPhase = ''
      gcc -c -Dversioned_lib_EXPORTS -fPIC "../versioned.c" -o "$out"
    '';
    installPhase = "true"; # No install needed for objects
  };

  app_main_c_o = stdenv.mkDerivation {
    name = "main.o";
    src = ./.;
    buildInputs = [ gcc ];
    dontFixup = true;
    # Configuration: Release
    buildPhase = ''
      gcc -c  "../main.c" -o "$out"
    '';
    installPhase = "true"; # No install needed for objects
  };

  static_helper_helper_c_o = stdenv.mkDerivation {
    name = "helper.o";
    src = ./.;
    buildInputs = [ gcc ];
    dontFixup = true;
    # Configuration: Release
    buildPhase = ''
      gcc -c  "../helper.c" -o "$out"
    '';
    installPhase = "true"; # No install needed for objects
  };

  mixed_app_mixed_c_o = stdenv.mkDerivation {
    name = "mixed.o";
    src = ./.;
    buildInputs = [ gcc ];
    dontFixup = true;
    # Configuration: Release
    buildPhase = ''
      gcc -c  "../mixed.c" -o "$out"
    '';
    installPhase = "true"; # No install needed for objects
  };


  # Linking derivations
  link_mylib = stdenv.mkDerivation {
    name = "libmylib.so";
    buildInputs = [ gcc ];
    dontUnpack = true;
    objects = [
      mylib_lib_c_o
    ];
    buildPhase = ''
      mkdir -p $out
      gcc -shared $objects -Wl,-rpath,$out/lib -o $out/libmylib.so
    '';
    installPhase = "true"; # No install needed
  };

  link_versioned_lib = stdenv.mkDerivation {
    name = "libversioned_lib.so";
    buildInputs = [ gcc ];
    dontUnpack = true;
    objects = [
      versioned_lib_versioned_c_o
    ];
    buildPhase = ''
      mkdir -p $out
      gcc -shared $objects -Wl,-soname,libversioned_lib.so.1 -Wl,-rpath,$out/lib -o $out/libversioned_lib.so.1.2.3
      ln -sf libversioned_lib.so.1.2.3 $out/libversioned_lib.so.1
      ln -sf libversioned_lib.so.1.2.3 $out/libversioned_lib.so
    '';
    installPhase = "true"; # No install needed
  };

  link_app = stdenv.mkDerivation {
    name = "app";
    buildInputs = [ gcc ];
    dontUnpack = true;
    objects = [
      app_main_c_o
    ];
    buildPhase = ''
      gcc $objects -o "$out"
    '';
    installPhase = "true"; # No install needed
  };

  link_static_helper = stdenv.mkDerivation {
    name = "static_helper";
    buildInputs = [ gcc ];
    dontUnpack = true;
    objects = [
      static_helper_helper_c_o
    ];
    buildPhase = ''
      ar rcs "$out" $objects
    '';
    installPhase = "true"; # No install needed
  };

  link_mixed_app = stdenv.mkDerivation {
    name = "mixed_app";
    buildInputs = [ gcc ];
    dontUnpack = true;
    objects = [
      mixed_app_mixed_c_o
    ];
    buildPhase = ''
      gcc $objects -o "$out"
    '';
    installPhase = "true"; # No install needed
  };

in
{
  "mylib" = link_mylib;
  "versioned_lib" = link_versioned_lib;
  "app" = link_app;
  "static_helper" = link_static_helper;
  "mixed_app" = link_mixed_app;
}

# Justfile for fmt library test

# Clean build artifacts
clean:
    rm -rf build default.nix

# Configure with CMake Nix generator
configure:
    rm -f default.nix
    ../bin/cmake -G Nix -DCMAKE_MAKE_PROGRAM=nix-build .

# Build the test
build: configure
    nix-build --no-out-link -A fmt_test

# Run the test
run: clean
    @echo "=== Building fmt library example with CMake Nix backend ==="
    just configure
    @echo "\n=== Building and running fmt test application ==="
    nix-build -A fmt_test && ./result && rm ./result
    @echo "\nâœ… fmt library built and tested successfully with CMake Nix backend!"

# Check generated Nix file
check-nix: configure
    @echo "=== Generated default.nix ==="
    cat default.nix | head -50
    @echo "\n... (truncated) ..."